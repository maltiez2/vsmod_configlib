# Documentation of JSON API of Config lib

## General description
Config lib is an optional dependency, which means that you don't need to add it to the dependencies list in modinfo.
When config lib is not installed, config files just won't be applied and default values in assets themselves will be used.
To add config with Config lib you just need to add `configlib-patches.json` file into `assets/your-domain/config/` folder of your mod.
This file defines set of settings, patches that change values in your assets, formatting of configuration file.
It also specified version. If you want to regenerate config files for players with default values just increase version
in your _configlib-patches.json_ file.

Example:
```json
{
  "version": 2,
  "patches": {
    "integer": {
      "maltiezfirearms:itemtypes/ammunition/bullet.json": {
        "behaviors/1/properties/damageTypesByType/*-steel/0/tier": "STEEL_BULLET_TIER"
      }
    }
  },
  "settings": {
    "integer": {
      "STEEL_BULLET_TIER": {
        "name": "steel-bullet-tier",
        "ingui": "maltiezfirearms:setting-steel-bullet-tier",
        "weight": 2.6,
        "comment": "Attack tier of a steel bullet (main usecase against heavily armoured players). It is balanced (at tier 7) to deal more damage to player in fullplate steel armour then lead alternative",
        "default": 7,
        "range": {
          "min": 0,
          "max": 20
        }
      }
    }
  },
  "formatting": [
    {
      "type": "separator",
      "weight": 1.0
    }
  ]
}
```

### Configuration files
Conflig lib allows for content mod to add optional configuration files that can be edited via GUI in-game
or directly in ModConfig folder. Configuration files will be autogenerated into ModConfig folder and named
_domain.yaml_ where _domain_ is your mod's domain. Config files are in YAML format.

Config files can have version that is used to regenerate old config file with new default values.
Also, config files support formatting blocks like titles and separators (that are also displayed in GUI).

Example of configuration file:
```yaml
version: 2
# Match being put out when player is swimming
match-put-out-by-water: Enabled # value from: Enabled, Disabled
# Chance that schematic will spawn in ruins in chests.Higher number means higher chance to find.But high chance will result in jonas parts becoming rare, cause they share smae stack randomizers.
schematic-spawn-chance: 1 # from 0 to 100 with step of 1
# Multiplies damage caused by firearms projectiles. It is recommended to leave in on 1.0. Default damages are balanced with considiration to vanilla animals and mobs hp values.
damage-multiplier: 1 # from 0.5 to 2
# Lower values correspond to higher accuracy
dispersion-multiplier: 1 # from 0 to 3


########################
### Bayonet settings ###
########################

# Value in description will not change and will show wrong number
bayonet-damage-when-attached: 4.8 # value from: 4.3, 4.8, 5.3
# Affects it effectiveness against armor. Steel falx has 5, all spears have 0. Value in description will not change and will show wrong number.
bayonet-damage-tier-when-attached: 5 # from 0 to 6 with step of 1
```

### Patches
Config lib implements its own patching system. You can patch any assets including JSON patches using settings values.
With a patch you can change value in an asset or add a value into array in asset.
These patches are meant for configuring existing values, so their functionality is limited.
You can patch assets in other mods (or vanilla assets), that can allow you to make a mod that will add configuration
to another mod. It can be useful for configuring mods for servers.

Patches has types that define what settings they can use and what values they will patch in.
There are: `boolean`, `float`, `ineteger`, `string` and `other` types of patches.
They support corresponding types of settings, except for `integer` and `float` types, that support any numerical settings
and also support math expressions and functions:

```
pi
e
sin(angle-in-radians)
cos(angle-in-radians)
abs(value)
sqrt(value)
ceiling(value)
floor(value)
exp(value)
log(value)
round(value)
sign(value),
clamp(value, min, max),
max(value),
min(value),
greater(left, right, if-left-greater, if-left-not-greater)
lesser(left, right, if-left-lesser, if-not-left-lesser)
equal(left, right, if-equal, if-not-equal)
notequal(left, right, if-not-equal, if-equal)
```

Example:
```json
"patches": {
    "float": {
      "maltiezfirearms:itemtypes/firearms/musket.json": {
        "behaviors/2/properties/systems/projectile/damageMultiplier": "DAMAGE * 1.63",
        "behaviors/2/properties/systems/aiming/dispersionMin_MOA": "DISPERSION * 60",
        "behaviors/2/properties/systems/melee/attacks/bayonet/damageTypes/0/damage": "BAYONET_DAMAGE",
        "behaviors/2/properties/systems/melee/attacks/bayonet/damageTypes/0/tier": "BAYONET_TIER",
        "behaviors/2/properties/systems/particles/fire/0/intensity": "SMOKE_DENSITY * 1.6",
        "behaviors/2/properties/systems/particles/fire/4/intensity": "FIREBLAST_DENSITY * 1.6"
      },
      "maltiezfirearms:patches/schematics.json": {
        "0/value/chance": "SCHEMATIC_CHANCE"
      }
    }
  }
```

### Settings
Patches use values from settings. Settings are what will be in configuration files and GUI.
Settings can be of different types: `boolean`, `float`, `ineteger`, `string` and `other`.

Each setting has some general properties. Let's look at `boolean` setting that is the simplest one.
Setting code is used in patches to refer to a setting.

`name` is used in YAML config file. It can't have spaces of special characters like `:`. You can use
`_` and `-` to make it more readable.

`ingui` if defined is used as lang code in GUI window, if it is not set, setting `name` will be used instead.

`weight` is used to sort settings in config file and GUI window. Should be greater than 0.

`comment` if set to a string will be added before setting in config file and as hint in GUI window.

`default` default value of a setting, player will be able to reset settings to default values in GUI, also this value
will be used to generate new config file.

Example:
```json
"SETTING_CODE": {
    "name": "yaml-code",
    "ingui": "domain:trainslation-code",
    "weight": 1.0,
    "comment": "some optional comment",
    "default": true
}
```

__boolean__ and __string__ settings don't have any other fields.

__float__ and __integer__ settings can also have `range` or `values` or `mapping` field, and `logarithmic`. In `range` you can specify maximum value, minimum value or step (that will
define slider step in GUI), or any combination of them. In `values` you can define a set of available values.
These fields do not restrict user from entering values in config file directly and are not used to validate them, but they are
used in GUI and are mentioned in autogenerated comments in config file. 'logarithmic' fields makes slider in GUI logarithmic.
`mapping` allows you to substitute value with a string in config file and GUI, `default` should be equal to one of the mapping strings.


```json
"POWDER_CONSUMPTION": {
    "name": "powder-to-flask-ratio",
    "ingui": "maltiezfirearms:setting-powder-to-flask-ratio",
    "weight": 2.3,
    "comment": "How much flask durability one powder item will fill",
    "default": 8,
    "logarithmic": true,
    "range": {
        "min": 1,
        "max": 64,
        "step": 1
    }
},
"BAYONET_DAMAGE": {
    "name": "bayonet-damage-when-attached",
    "ingui": "maltiezfirearms:setting-bayonet-damage-when-attached",
    "weight": 3.1,
    "comment": "Value in description will not change and will show wrong number",
    "default": 4.8,
    "values": [
        4.3,
        4.8,
        5.3
    ]
},
"MATCH_PUT_OUT": {
    "name": "match-put-out-by-water",
    "ingui": "maltiezfirearms:setting-match-put-out-by-water",
    "comment": "Match being put out when player is swimming",
    "default": "Enabled",
    "weight": 0.1,
    "mapping": {
        "Enabled": 1.0,
        "Disabled": 0.0
    }
},
```

__other__ settings only have `mapping` additional field, but you can put any JSON token as value in it.

### Formatting
You can specify additional blocks in config file and GUI window. They are:
- __Separator__ - adds a line into GUI and 2 empty lines in config file. Weight is used to sort formatting blocks and settings
in file and GUI. 
```json
{
    "type": "separator",
    "weight": 1.0
}
```
```yaml


```
- __Title__ - separator with title
```json
{
    "type": "separator",
    "title": "Title"
    "weight": 1.0
}
```
```yaml


###########
## Title ##
###########

```

- __Text__ - separator with text
```json
{
    "type": "separator",
    "text": "Some text\nSome more text"
    "weight": 1.0
}
```
```yaml


# Some text
# Some more text
```